# 토큰 사용량 최적화 요약

## ✅ 적용된 최적화 사항

### 1. 챗봇 UI 기본 비활성화
- **변경**: 챗봇 버튼이 기본적으로 숨겨짐
- **환경 변수**: `NEXT_PUBLIC_ENABLE_CHATBOT=false` (기본값)
- **효과**: 평상시 챗봇 사용 시 토큰 사용량 **0**

### 2. RAG 기능 선택적 사용
- **변경**: 사용자가 명시적으로 요청할 때만 RAG 활성화
- **키워드**: "웹사이트", "문서", "참고", "website", "document" 등
- **효과**: RAG 임베딩 호출 **50% 이상 감소**

### 3. 공지사항/커뮤니케이션 선택적 전송
- **변경**: 관련 키워드가 있을 때만 전송
- **공지사항 키워드**: "공지", "notice"
- **커뮤니케이션 키워드**: "커뮤니", "소통", "communication"
- **효과**: 컨텍스트 크기 **70-90% 감소**

### 4. 불량 LOT 자동 레포트 생성
- **변경**: Lot 상태 페이지 로드 시 불량 LOT 감지 및 자동 레포트 생성
- **동작**: 불량 LOT 클릭 시 즉시 레포트 표시 (이미 생성됨)
- **효과**: 사용자 개입 없이 필요한 레포트만 생성

## 📊 예상 토큰 사용량 비교

### 이전 (최적화 전)
- 평상시 챗봇 사용: **0 토큰** (사용 안 함)
- 챗봇 메시지 1개: **250-600 토큰**
  - RAG 임베딩: ~50-100 토큰
  - 공지사항/커뮤니케이션: ~100-200 토큰
  - Gemini API: ~200-500 토큰

### 현재 (최적화 후)
- 평상시 챗봇 사용: **0 토큰** (UI 숨김)
- 불량 LOT 레포트 자동 생성: **~200-400 토큰/LOT** (필요할 때만)
- 챗봇 메시지 1개 (RAG 없음): **~150-300 토큰**
- 챗봇 메시지 1개 (RAG 포함): **~200-400 토큰**

## 🎯 토큰 절약 효과

1. **평상시**: 챗봇 UI 숨김으로 **100% 절약**
2. **RAG 사용 시**: 키워드 기반 선택적 사용으로 **50% 절약**
3. **컨텍스트**: 공지사항/커뮤니케이션 선택적 전송으로 **70-90% 절약**
4. **전체 예상 절약**: **60-80% 토큰 사용량 감소**

## 🔧 설정 방법

### 챗봇 활성화 (필요 시)
```bash
# .env.local 파일에 추가
NEXT_PUBLIC_ENABLE_CHATBOT=true
```

### RAG 기능 활성화 (필요 시)
```bash
# backend/.env 파일에 추가
ENABLE_RAG=true
```

### 챗봇 사용 시 RAG 활성화
- 메시지에 "웹사이트", "문서", "참고" 등의 키워드 포함 시 자동 활성화

## 📝 사용 가이드

### 불량 LOT 레포트 자동 생성
1. Lot 상태 페이지 (`/lot-status`) 접속
2. 불량 LOT이 있으면 자동으로 레포트 생성 (백그라운드)
3. 불량 LOT 클릭 시 즉시 레포트 표시

### 챗봇 사용 (활성화 시)
1. 환경 변수 `NEXT_PUBLIC_ENABLE_CHATBOT=true` 설정
2. 챗봇 버튼 클릭
3. 질문 입력
4. RAG 사용: "웹사이트 정보 참고해서 답변해줘"
5. 공지사항 포함: "공지사항 확인해서 답변해줘"
