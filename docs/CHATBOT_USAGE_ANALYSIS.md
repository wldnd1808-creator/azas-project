# 챗봇 시스템 사용 현황 및 토큰 사용량 분석

## 📍 챗봇이 사용되는 페이지 (총 10개)

1. **대시보드** (`/dashboard`)
2. **센서 차트** (`/sensor-chart`)
3. **공정 모델** (`/process-model`)
4. **분석** (`/analytics`)
5. **Lot 상태** (`/lot-status`)
6. **공정 모델 2** (`/process-model-2`)
7. **품질 히트맵** (`/quality-heatmap`)
8. **불량 분석** (`/defect-analysis`)
9. **설정** (`/settings`)
10. **직원 관리** (`/employee`)

## 🔥 토큰 사용량이 많은 이유

### 현재 구조:
각 챗봇 메시지 전송 시 **2번의 API 호출** 발생:

1. **RAG 임베딩 호출** (`GoogleGenerativeAIEmbeddings`)
   - 모델: `gemini-embedding-001`
   - 용도: 관련 문서 검색을 위한 임베딩 생성
   - 토큰 사용: 입력 메시지의 토큰 수

2. **Gemini API 호출** (`generateContent`)
   - 모델: `gemini-pro`
   - 용도: 실제 챗봇 응답 생성
   - 토큰 사용: 입력(프롬프트) + 출력(응답)

### 예상 토큰 사용량:
- 사용자 메시지 1개 전송 시:
  - 임베딩: ~50-100 토큰 (메시지 길이에 따라)
  - 생성: ~200-500 토큰 (프롬프트 + 응답)
  - **총: 약 250-600 토큰/메시지**

## 💡 토큰 사용량 절감 방안

### 1. RAG 기능 비활성화 (즉시 적용 가능)
- RAG는 선택사항이므로 비활성화 가능
- 토큰 사용량 **50% 감소** 예상

### 2. RAG 캐싱 추가
- 동일한 메시지에 대한 임베딩 결과 캐싱
- 중복 호출 방지

### 3. 사용자 옵션 제공
- RAG 사용 여부를 사용자가 선택할 수 있도록 UI 추가

### 4. 프롬프트 최적화
- 불필요한 컨텍스트 제거
- 프롬프트 길이 단축

## 🛠️ 권장 조치

1. **즉시**: RAG 기능 비활성화 또는 선택적 사용
2. **단기**: 캐싱 메커니즘 추가
3. **중기**: 사용자 설정에서 RAG 옵션 제공
