# 각 페이지에서 챗봇 사용 방식

## 📋 RightSidebar 컴포넌트 구조

`RightSidebar`는 모든 페이지에서 **동일한 3가지 기능**을 제공합니다:

1. **공지사항 (Notices)** - 상단 절반
2. **커뮤니케이션 (Communications)** - 하단 절반  
3. **챗봇 (Chatbot)** - 하단 고정 버튼

## 🤖 챗봇 사용 방식 (모든 페이지 동일)

### 1. 위치 및 접근
- **위치**: 오른쪽 사이드바 하단에 고정된 버튼
- **버튼 텍스트**: "챗봇 열기" / "Open Chatbot"
- **동작**: 클릭 시 사이드바 전체가 챗봇 화면으로 전환

### 2. 챗봇 기능
- **메시지 입력**: 텍스트 입력 필드에 질문 입력
- **전송**: Enter 키 또는 전송 버튼 클릭
- **대화 히스토리**: 최근 10개 메시지 유지
- **로컬 저장**: localStorage에 대화 내용 저장 (페이지 새로고침 시에도 유지)

### 3. 백엔드 API 호출
각 메시지 전송 시 다음 데이터를 백엔드로 전송:

```typescript
POST /api/chat
{
  message: "사용자 입력 메시지",
  conversationHistory: [
    { role: "user", text: "이전 사용자 메시지" },
    { role: "bot", text: "이전 봇 응답" }
    // 최근 10개만
  ],
  notices: [
    {
      title: "공지사항 제목",
      content: "공지사항 내용",
      date: "2025.01.27",
      important: true
    }
    // 현재 페이지의 공지사항 전체
  ],
  communications: [
    {
      user: "사용자명",
      message: "메시지 제목",
      content: "메시지 내용",
      time: "10:30"
    }
    // 현재 페이지의 커뮤니케이션 전체
  ]
}
```

### 4. 컨텍스트 활용
챗봇은 다음 정보를 활용하여 응답:
- **공지사항**: 현재 페이지의 모든 공지사항 내용
- **커뮤니케이션**: 현재 페이지의 모든 커뮤니케이션 내용
- **대화 히스토리**: 최근 10개 메시지
- **사용자 정보**: 이름, 역할(admin/user)

## 📍 각 페이지별 사용 현황

### 1. 대시보드 (`/dashboard`)
- **용도**: 공정 현황, 생산량, 품질률 등 대시보드 데이터에 대한 질문
- **컨텍스트**: 대시보드 관련 공지사항 및 커뮤니케이션
- **예시 질문**: "오늘 생산량은 얼마야?", "품질률이 낮은 이유는?"

### 2. 센서 차트 (`/sensor-chart`)
- **용도**: 센서 데이터, 차트 해석, 이상 징후 파악
- **컨텍스트**: 센서 관련 공지사항 및 커뮤니케이션
- **예시 질문**: "온도 센서가 이상한데 왜 그런가요?", "압력 그래프 해석해줘"

### 3. 공정 모델 (`/process-model`)
- **용도**: 공정 모델 구조, 설비 배치, 공정 흐름 질문
- **컨텍스트**: 공정 모델 관련 공지사항 및 커뮤니케이션
- **예시 질문**: "라인 A의 공정 순서는?", "어떤 설비가 연결되어 있나요?"

### 4. 분석 (`/analytics`)
- **용도**: 데이터 분석, 트렌드 파악, 인사이트 도출
- **컨텍스트**: 분석 관련 공지사항 및 커뮤니케이션
- **예시 질문**: "생산량 추이는?", "어느 시간대에 불량이 많나요?"

### 5. Lot 상태 (`/lot-status`)
- **용도**: Lot별 상태, 진행 상황, 이력 조회
- **컨텍스트**: Lot 관련 공지사항 및 커뮤니케이션
- **예시 질문**: "Lot #12345 상태는?", "지연된 Lot이 있나요?"

### 6. 공정 모델 2 (`/process-model-2`)
- **용도**: 공정 모델 v2 관련 질문 (공정 모델과 유사)
- **컨텍스트**: 공정 모델 2 관련 공지사항 및 커뮤니케이션

### 7. 품질 히트맵 (`/quality-heatmap`)
- **용도**: 품질 데이터 시각화, 문제 영역 파악
- **컨텍스트**: 품질 관련 공지사항 및 커뮤니케이션
- **예시 질문**: "어느 구역이 품질 문제가 많나요?", "히트맵 해석해줘"

### 8. 불량 분석 (`/defect-analysis`)
- **용도**: 불량 원인 분석, 패턴 파악, 개선 방안
- **컨텍스트**: 불량 관련 공지사항 및 커뮤니케이션
- **예시 질문**: "가장 많은 불량 유형은?", "불량 원인 분석해줘"

### 9. 설정 (`/settings`)
- **용도**: 시스템 설정, 사용자 관리 관련 질문
- **컨텍스트**: 설정 관련 공지사항 및 커뮤니케이션
- **예시 질문**: "비밀번호 변경 방법은?", "권한 설정은 어떻게 하나요?"

### 10. 직원 관리 (`/employee`)
- **용도**: 직원 정보, 관리 관련 질문
- **컨텍스트**: 직원 관련 공지사항 및 커뮤니케이션
- **예시 질문**: "직원 목록 조회 방법은?", "권한 부여는 어떻게 하나요?"

## ⚠️ 중요 사항

### 모든 페이지에서 동일한 동작
- 챗봇 기능은 **페이지와 무관하게 동일하게 작동**
- 차이점은 각 페이지의 **공지사항과 커뮤니케이션 데이터**만 다름
- 챗봇이 해당 페이지의 컨텍스트를 활용하여 더 정확한 답변 제공

### 토큰 사용량
- 각 메시지마다 **공지사항 전체 + 커뮤니케이션 전체**가 컨텍스트로 전송됨
- 공지사항/커뮤니케이션이 많을수록 토큰 사용량 증가
- RAG 기능 활성화 시 추가 토큰 사용 (현재 비활성화됨)

### 개선 제안
1. **컨텍스트 최적화**: 관련성 높은 공지사항/커뮤니케이션만 전송
2. **페이지별 프롬프트**: 각 페이지의 목적에 맞는 프롬프트 사용
3. **캐싱**: 동일한 질문에 대한 응답 캐싱
